# Reasoning åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ“… æ›´æ–°æ—¥æœŸ

2026-01-08

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

ä¸º XiamenLabs OpenAI Proxy çš„ Web UI æ·»åŠ äº†å¯¹ AI æ¨¡å‹æ¨ç†è¿‡ç¨‹ï¼ˆreasoningï¼‰çš„å¯è§†åŒ–æ”¯æŒã€‚

## ğŸ“¦ å˜æ›´å†…å®¹

### 1. å‰ç«¯ä»£ç æ›´æ–° (`web/index.html`)

#### CSS æ ·å¼æ–°å¢

```css
/* æ¨ç†å†…å®¹æ ·å¼ */
.reasoning-section {
  background: rgba(79, 70, 229, 0.05);
  border-left: 3px solid var(--primary-color);
  padding: 0.75rem 1rem;
  margin: 0.5rem 0;
  border-radius: 0.5rem;
  font-size: 0.9rem;
}

.reasoning-header {
  font-weight: 600;
  color: var(--primary-color);
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.reasoning-content {
  color: var(--text-secondary);
  white-space: pre-wrap;
  line-height: 1.6;
}
```

#### JavaScript åŠŸèƒ½å¢å¼º

**ä¿®æ”¹å‰ï¼š**

- åªå¤„ç† `delta.content` å­—æ®µ
- ç›´æ¥æ›´æ–° `messageContent.textContent`

**ä¿®æ”¹åï¼š**

- åŒæ—¶å¤„ç† `delta.reasoning` å’Œ `delta.content`
- ä¸ºæ¨ç†å†…å®¹åˆ›å»ºä¸“å±åŒºåŸŸ `reasoning-section`
- ä¸ºå›å¤å†…å®¹åˆ›å»ºç‹¬ç«‹åŒºåŸŸ `response-content`
- æ”¯æŒä¸¤ç§å†…å®¹çš„å®æ—¶æµå¼æ›´æ–°

### 2. æ–‡æ¡£æ–°å¢

#### `.agent/docs/Stage1/reasoning-support.md`

å®Œæ•´çš„åŠŸèƒ½æ–‡æ¡£ï¼ŒåŒ…å«ï¼š

- API å“åº”æ ¼å¼ç¤ºä¾‹
- å‰ç«¯å±•ç¤ºæ•ˆæœè¯´æ˜
- å®ç°ç»†èŠ‚ï¼ˆCSS + JavaScriptï¼‰
- ä½¿ç”¨ç¤ºä¾‹å’Œæµ‹è¯•æ­¥éª¤
- å…¼å®¹æ€§è¯´æ˜
- è§†è§‰æ•ˆæœç¤ºæ„å›¾
- æœªæ¥ä¼˜åŒ–å»ºè®®

#### `.agent/tests/Stage1/test-reasoning.ps1`

è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼ŒåŠŸèƒ½ï¼š

- æ£€æŸ¥æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€
- è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨åˆ°èŠå¤©ç•Œé¢
- æä¾›æµ‹è¯•æŒ‡å¼•å’Œæ–‡æ¡£é“¾æ¥

### 3. README æ›´æ–°

æ·»åŠ äº†ä»¥ä¸‹å†…å®¹ï¼š

- åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨ä¸­æ–°å¢"Reasoning æ”¯æŒ"
- Web UI ç«¯ç‚¹è¯´æ˜
- Web UI ç‰¹æ€§ä»‹ç»
- Reasoning åŠŸèƒ½ä½¿ç”¨è¯´æ˜
- æ–‡æ¡£é“¾æ¥

## ğŸ” æŠ€æœ¯å®ç°ç»†èŠ‚

### æ•°æ®æµ

```
API å“åº”
    â†“
åŒ…å« delta.reasoning å’Œ/æˆ– delta.content
    â†“
JavaScript è§£æ SSE æµ
    â†“
åˆ†åˆ«å¤„ç†ä¸¤ç§å­—æ®µ
    â†“
åŠ¨æ€åˆ›å»º/æ›´æ–° DOM å…ƒç´ 
    â†“
å®æ—¶æ˜¾ç¤ºç»™ç”¨æˆ·
```

### DOM ç»“æ„

```html
<div class="message assistant">
  <div class="avatar">ğŸ¤–</div>
  <div class="message-content">
    <!-- å¦‚æœæœ‰ reasoning -->
    <div class="reasoning-section">
      <div class="reasoning-header">
        <span>ğŸ§ </span>
        <span>æ€è€ƒè¿‡ç¨‹</span>
      </div>
      <div class="reasoning-content">
        <!-- reasoning æ–‡æœ¬ -->
      </div>
    </div>

    <!-- å›å¤å†…å®¹ -->
    <div class="response-content">
      <!-- content æ–‡æœ¬ -->
    </div>
  </div>
</div>
```

### å¤„ç†é€»è¾‘

```javascript
// ä¼ªä»£ç 
for each SSE chunk:
  parse JSON

  if has delta.reasoning:
    create/update reasoning section
    append reasoning text
    scroll to bottom

  if has delta.content:
    create/update content section
    append content text
    scroll to bottom
```

## âœ… æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯

1. **åªæœ‰ content**ï¼šæ­£å¸¸æ˜¾ç¤ºå›å¤å†…å®¹
2. **åªæœ‰ reasoning**ï¼šåªæ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹åŒºåŸŸ
3. **åŒæ—¶æœ‰ reasoning å’Œ content**ï¼šæŒ‰é¡ºåºæ˜¾ç¤ºä¸¤ä¸ªåŒºåŸŸ
4. **äº¤æ›¿å‡ºç°**ï¼šæ­£ç¡®ç´¯ç§¯å„è‡ªçš„å†…å®¹

### æµ‹è¯•æ–¹æ³•

ä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼š

```powershell
.\.agent\tests\Stage1\test-reasoning.ps1
```

æˆ–æ‰‹åŠ¨æµ‹è¯•ï¼š

1. å¯åŠ¨æœåŠ¡å™¨
2. è®¿é—® `http://localhost:8080/`
3. å‘é€ä»»æ„æ¶ˆæ¯
4. è§‚å¯Ÿå“åº”æ ¼å¼

## ğŸ¨ è§†è§‰æ•ˆæœ

### Reasoning åŒºåŸŸç‰¹å¾

- **èƒŒæ™¯è‰²**ï¼š`rgba(79, 70, 229, 0.05)` - æ·¡ç´«è‰²
- **å·¦è¾¹æ¡†**ï¼š3px è“è‰²å®çº¿ (`--primary-color`)
- **å›¾æ ‡**ï¼šğŸ§  è¡¨ç¤ºæ€è€ƒ
- **æ ‡é¢˜**ï¼š"æ€è€ƒè¿‡ç¨‹" - æ·±è“è‰²åŠ ç²—
- **å†…å®¹**ï¼šç°è‰²æ–‡å­—ï¼Œä¿ç•™æ¢è¡Œå’Œç©ºæ ¼

### å›å¤å†…å®¹åŒºåŸŸ

- ä½¿ç”¨æ ‡å‡†æ¶ˆæ¯æ ·å¼
- æ”¯æŒ Markdown æ ¼å¼
- æ”¯æŒä»£ç å—é«˜äº®

## ğŸ“Š å…¼å®¹æ€§

| ç‰¹æ€§                     | æ”¯æŒæƒ…å†µ            |
| ------------------------ | ------------------- |
| å‘åå…¼å®¹ï¼ˆæ—  reasoningï¼‰ | âœ… å®Œå…¨å…¼å®¹         |
| åªæœ‰ reasoning           | âœ… æ­£å¸¸æ˜¾ç¤º         |
| åªæœ‰ content             | âœ… æ­£å¸¸æ˜¾ç¤º         |
| åŒæ—¶åŒ…å«ä¸¤è€…             | âœ… å®Œç¾æ”¯æŒ         |
| äº¤æ›¿å‡ºç°                 | âœ… æ­£ç¡®å¤„ç†         |
| æµå¼æ›´æ–°                 | âœ… å®æ—¶æ˜¾ç¤º         |
| éæµå¼å“åº”               | âš ï¸ æš‚æœªå¤„ç†ï¼ˆTODOï¼‰ |

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### API è¿”å›æ ¼å¼

```json
{
  "id": "chatcmpl-xx-xxx",
  "object": "chat.completion.chunk",
  "created": 1767804560,
  "model": "x",
  "choices": [
    {
      "index": 0,
      "delta": {
        "reasoning": "æˆ‘æ­£åœ¨æ€è€ƒå¦‚ä½•å›ç­”è¿™ä¸ªé—®é¢˜...\n"
      },
      "finish_reason": null
    }
  ]
}
```

### ç”¨æˆ·çœ‹åˆ°çš„æ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– åŠ©æ‰‹                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ§  æ€è€ƒè¿‡ç¨‹                    â”‚   â”‚
â”‚ â”‚                               â”‚   â”‚
â”‚ â”‚ æˆ‘æ­£åœ¨æ€è€ƒå¦‚ä½•å›ç­”è¿™ä¸ªé—®é¢˜... â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚ è¿™æ˜¯æˆ‘çš„å›ç­”...                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### é«˜ä¼˜å…ˆçº§

1. â­ æ·»åŠ æŠ˜å /å±•å¼€æ¨ç†åŒºåŸŸçš„åŠŸèƒ½
2. â­ å¯¹éæµå¼å“åº”ä¹Ÿæ”¯æŒ reasoning æ˜¾ç¤º
3. â­ æ·»åŠ å¤åˆ¶æ¨ç†å†…å®¹çš„æŒ‰é’®

### ä¸­ä¼˜å…ˆçº§

4. ğŸ”¸ å¯¹ reasoning å†…å®¹åº”ç”¨ Markdown æ¸²æŸ“
5. ğŸ”¸ æ·»åŠ è¯­æ³•é«˜äº®ï¼ˆå¦‚æœ reasoning åŒ…å«ä»£ç ï¼‰
6. ğŸ”¸ æ”¯æŒå¯¼å‡ºåŒ…å«æ¨ç†è¿‡ç¨‹çš„å®Œæ•´å¯¹è¯

### ä½ä¼˜å…ˆçº§

7. ğŸ”¹ æ·»åŠ æ¨ç†æ—¶é—´ç»Ÿè®¡
8. ğŸ”¹ æ”¯æŒè‡ªå®šä¹‰æ¨ç†åŒºåŸŸé¢œè‰²ä¸»é¢˜
9. ğŸ”¹ æ·»åŠ æ¨ç†å†…å®¹æœç´¢åŠŸèƒ½

## ğŸ“‚ ç›¸å…³æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶

- âœï¸ `web/index.html` - æ·»åŠ  reasoning æ”¯æŒ

### æ–°å¢çš„æ–‡ä»¶

- â• `.agent/docs/Stage1/reasoning-support.md` - åŠŸèƒ½æ–‡æ¡£
- â• `.agent/tests/Stage1/test-reasoning.ps1` - æµ‹è¯•è„šæœ¬
- â• `.agent/docs/Stage1/reasoning-implementation-summary.md` - æœ¬æ–‡æ¡£

### æ›´æ–°çš„æ–‡ä»¶

- ğŸ“ `README.md` - æ·»åŠ åŠŸèƒ½è¯´æ˜

## ğŸ”— ç›¸å…³é“¾æ¥

- [Reasoning æ”¯æŒæ–‡æ¡£](.agent/docs/Stage1/reasoning-support.md)
- [æµ‹è¯•è„šæœ¬](.agent/tests/Stage1/test-reasoning.ps1)
- [ä¸» README](../../README.md)

## âœ¨ æ€»ç»“

æ­¤æ¬¡æ›´æ–°ä¸º Web UI æ·»åŠ äº†å®Œæ•´çš„ reasoning å¯è§†åŒ–æ”¯æŒï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿï¼š

- ğŸ‘€ çœ‹åˆ° AI çš„æ€è€ƒè¿‡ç¨‹
- ğŸ“Š ç†è§£ AI çš„æ¨ç†é€»è¾‘
- ğŸ“ å­¦ä¹  AI å¦‚ä½•è§£å†³é—®é¢˜

å®ç°ç®€æ´ã€æ€§èƒ½è‰¯å¥½ã€å‘åå…¼å®¹ï¼Œä¸ºåç»­åŠŸèƒ½æ‰©å±•å¥ å®šäº†åŸºç¡€ã€‚
